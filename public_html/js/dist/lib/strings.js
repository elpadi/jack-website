define(["underscore","lib/numbers/NumberList"],function(underscore,NumberList){var WORD_REGEX=/\s+/;var fake_paragaph=document.createElement("p");function step_break_paragraph(s,initial,step,word_regex,glue){if(arguments.length<4){word_regex=WORD_REGEX}if(arguments.length<5){glue="<br />"}fake_paragaph.innerHTML=s.replace(/<br\s*>/g," ");s=fake_paragaph.textContent;var lines=[],breaks=[-1],i=0,cutAmount=initial,increment=step,words=s.split(word_regex);var words_lengths=_.pluck(words,"length"),count=words.length;for(var k=1;k<count;k++){words_lengths[k]+=words_lengths[k-1]}var max=words_lengths[count-1];words_lengths=new NumberList(words_lengths);while(cutAmount<=max&&increment<initial){words_lengths.closest(cutAmount,function(length,key){breaks.push(key)});cutAmount+=initial-increment;increment+=step}for(var j=1;j<breaks.length;j++){lines.push(words.slice(breaks[j-1]+1,breaks[j]+1).join(" "))}lines.push(words.slice(breaks[j-1]+1).join(" "));return lines.join("<br />")}return{step_break_paragraph:step_break_paragraph}});