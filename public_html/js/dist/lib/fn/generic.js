define(["underscore"],function(underscore){function Generic(context){this.context=context;this.fns=[]}Generic.prototype={register:function(types,fn){var f=_.detect(this.fns,function(f){return f.types===types});if(f){f.fn=fn}else{this.fns.push({types:types,fn:fn})}return this},getByType:function(args){var _this=this;return _.detect(this.fns,function(f){if(args.length!==f.types.length){return false}return _.every(f.types,function(t,i){var v=args[i];switch(typeof t){case"string":return t===typeof v;case"function":return v instanceof t;default:return t===v}})})},fn:function(){var _this=this;return function(){var f=_this.getByType(arguments);if(!f){throw"Type not registered."}return f.fn.apply(_this.context,_.toArray(arguments))}}};function generic(context){return new Generic(context)}return generic});