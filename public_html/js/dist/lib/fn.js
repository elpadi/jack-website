define(["underscore","./utils","lib/fn/generic","lib/fn/compose"],function(underscore,utils,Generic,compose){function bind(fn,thisArg){return function(){return fn.apply(thisArg,_.toArray(arguments))}}function skip(fn,count){if(arguments.length<2){count=1}return function(){var args=arguments.length>count?_.toArray(arguments).slice(count):[];return fn.apply(this,args)}}function flip(fn){return function(){return fn.apply(this,_.toArray(arguments).reverse())}}function curry(fn){var args=_.rest(arguments);return function(){return fn.apply(this,args.concat(_.toArray(arguments)))}}function preprocess(fn,preprocessor){return function(){return fn.apply(this,_.map(arguments,preprocessor))}}function splat(fn){return function(list){return _.map(list,fn,this)}}function maybe(validator,fn){return function(){var args=_.toArray(arguments);if(validator.apply(this,args)){return fn.apply(this,args)}return undefined}}function continuation(fn,next,context){return function(){return next.call(context,fn.apply(this,_.first(arguments,arguments.length-1)))}}function conditional_continuation(fn,next,context){return function(){var result=fn.apply(this,_.first(arguments,arguments.length-1));if(utils.isSomething(result)){return next.call(context,result)}}}function reduce(fn,initial){return function(){return _.reduce(_.toArray(arguments),fn,initial)}}function makeSync(fn){return function(done){fn.apply(this,_.rest(arguments));done()}}function onAllFinished(options){var fns=_.rest(arguments);var total=fns.length;var count=0;var done=function(){count++;return count===total?options.callback():null};options=_.extend({callback:utils.blank(),mode:"auto"},options);return(options.mode==="auto"?onAllFinishedAuto:onAllFinishedManual).call(this,fns,done)}function onAllFinishedAuto(fns,done){return function(){_.each(fns,function(fn){fn(done)})}}function onAllFinishedManual(fns,done){return function(index){return fns[index](done)}}function runOnSequence(){var fns=_.toArray(arguments);var lastReturn;var done=function done(){var value;if(fns.length>0){value=fns.shift().call(this,done,lastReturn);lastReturn=value===undefined?lastReturn:value}};return{start:done,stop:function(){fns=[]}}}function generic(context){return new Generic(context)}function construct(ConstructFn){function A(args){return ConstructFn.apply(this,args)}A.prototype=ConstructFn.prototype;return function(){return new A(_.toArray(arguments))}}return{compose:compose,bind:bind,skip:skip,flip:flip,curry:curry,preprocess:preprocess,splat:splat,reduce:reduce,maybe:maybe,cont:continuation,condCont:conditional_continuation,async:{runGroup:onAllFinished,seq:runOnSequence,sync:makeSync},generic:generic,construct:construct}});