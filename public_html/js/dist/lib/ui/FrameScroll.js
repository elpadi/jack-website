define(["jquery","underscore","lib/ui/interface/Easing"],function(jquery,underscore,Easing){var STYLE_REGEX=/left:\s*((-)?[0-9]+(\.[0-9]+)?)%(;)?/;var NAV_BUTTON_REGEX=/frame-scroll__nav__(left|right)/;function FrameScroll($container,elementsPerFrame,animationDuration,spaceBetweenElements){var _this=this;this.$container=$container;this.$scroller=$container.find(".frame-scroll__scroller");this.$elements=$container.find(".frame-scroll__element");this.isRotating=this.$elements.length>1&&$container.hasClass("frame-scroll--rotating");arguments.length>1&&this.setElementsPerFrame(elementsPerFrame);arguments.length>2&&this.setDuration(animationDuration);arguments.length>3&&this.setSpaceBetweenElements(spaceBetweenElements);$(window).on("resize",_.debounce(_.bind(this.resetFramesPosition,this),100));$container.find(".frame-scroll__nav").on("click",function(e){var matches=NAV_BUTTON_REGEX.exec(e.target.className);if(matches&&matches.length<2){return true}e.preventDefault();_this["scroll"+matches[1][0].toUpperCase()+matches[1].substr(1)]()})}FrameScroll.prototype=$.extend({},Easing);FrameScroll.prototype.duration=700;FrameScroll.prototype.elementsPerFrame=1;FrameScroll.prototype.isRotating=false;FrameScroll.prototype.easing="swing";FrameScroll.prototype.spaceBetweenElements=0;FrameScroll.prototype.setDuration=function(animationDuration){this.duration=animationDuration};FrameScroll.prototype.setSpaceBetweenElements=function(spaceBetweenElements){if(this.elementsPerFrame>1){this.spaceBetweenElements=spaceBetweenElements;this.resetUI()}};FrameScroll.prototype.setElementsPerFrame=function(elementsPerFrame){this.elementsPerFrame=elementsPerFrame;this.resetUI()};FrameScroll.prototype.resetUI=function(){this.resetFramesPosition();this.minScroll=(Math.ceil(this.$elements.length/this.elementsPerFrame)-1)*(-100-this.spaceBetweenElements)};FrameScroll.prototype.getFrameLeft=function(index){return index*(100/this.elementsPerFrame+this.spaceBetweenElements)};FrameScroll.prototype.resetFramesPosition=function(){var _this=this;var totalFreeSpace=this.spaceBetweenElements*(this.elementsPerFrame-1);var width=(100-totalFreeSpace)/this.elementsPerFrame;this.$elements.css("width",width+"%").slice(1).each(function(i,el){var $el=$(el);$el.css({left:(i+1)*(width+_this.spaceBetweenElements)+"%"})})};FrameScroll.prototype.setEdgeClassname=function(currentValue){this.$container.toggleClass("frame-scroll--left-edge",currentValue===0);this.$container.toggleClass("frame-scroll--right-edge",currentValue===this.minScroll)};FrameScroll.prototype.doRotate=function(){if(this.$elements.length>1&&!this.isRotating){this.isRotating=true;this.$container.removeClass("frame-scroll--left-edge frame-scroll--right-edge")}return this};FrameScroll.prototype.doNotRotate=function(){if(this.isRotating){this.isRotating=false;this.setEdgeClassname(this.getCurrentScroll())}return this};FrameScroll.prototype.onScrollFinish=function(currentValue,oldValue){if(this.isRotating){if(currentValue>0){this.$elements.last().css({left:this.minScroll*-1+"%"});this.$scroller.css({left:this.minScroll+"%"})}if(currentValue<this.minScroll){this.$scroller.add(this.$elements.first()).css({left:""})}}else{this.setEdgeClassname(currentValue)}};FrameScroll.prototype.getCurrentScroll=function(){var style=this.$scroller.attr("style");if(!style){return 0}style=style.toString().toLowerCase();if(style.indexOf("left:")===-1){return 0}var matches=style.match(STYLE_REGEX);if(matches&&matches.length<2){return 0}return Number(parseFloat(matches[1]).toFixed(2))};FrameScroll.prototype.scroll=function(newValue,currentValue,withAnimation){var _this=this;if(newValue===currentValue){return}if(this.isRotating){if(currentValue===0&&newValue>0){this.$elements.last().css({left:"-100%"})}if(currentValue===this.minScroll&&newValue<currentValue){this.$elements.first().css({left:this.minScroll*-1+100+"%"})}}if(withAnimation===false){this.$scroller.css("left",newValue+"%");this.onScrollFinish(newValue,currentValue)}else{this.$scroller.animate({left:newValue+"%"},this.duration,this.easing,function(){_this.onScrollFinish(newValue,currentValue)})}};FrameScroll.prototype.moveBy=function(amount){return this.scrollBy(amount,false)};FrameScroll.prototype.scrollBy=function(amount,withAnimation){var current=this.getCurrentScroll();var next=this.getNextScroll(amount,current);this.scroll(this.sanitizeScrollValue(next),current,withAnimation!==false)};FrameScroll.prototype.scrollTo=function(newValue,withAnimation){var current=this.getCurrentScroll();this.scroll(this.sanitizeScrollValue(newValue),current,withAnimation!==false)};FrameScroll.prototype.sanitizeScrollValue=function(value){return this.isRotating?value:value>0?0:Math.max(this.minScroll,value)};FrameScroll.prototype.getNextScroll=function(amount,current){return current+amount*this.getFrameLeft(this.elementsPerFrame)};FrameScroll.prototype.scrollRight=function(){this.scrollBy(-1)};FrameScroll.prototype.scrollLeft=function(){this.scrollBy(1)};return FrameScroll});