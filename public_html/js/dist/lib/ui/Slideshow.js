if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(["require","../../components/underscore/underscore","../../components/js-signals/dist/signals","../functions","../dom"],function(require){var _=require("../../components/underscore/underscore");var signals=require("../../components/js-signals/dist/signals");var fn=require("../functions");var dom=require("../dom");function Slideshow(){this.signals.imageLoaded.add(function($newImage){this.$imageContainer.append($newImage)},this)}Slideshow.signalKeys=["imageLoaded","transitionFinished"];Slideshow.preprocessImage=function($image){return $(document.createElement("div")).addClass("image").css({backgroundImage:"url("+$image.attr("src")+")"})};Slideshow.prototype.$imageContainer=$(document.body);Slideshow.prototype.$currentImage=null;Slideshow.prototype.$newImage=null;Slideshow.prototype.transition=null;Slideshow.prototype.sequence=null;Slideshow.prototype.signals={};_.each(Slideshow.signalKeys,function(key){Slideshow.prototype.signals[key]=new signals.Signal});Slideshow.prototype.switchToImage=function(image){if(typeof this.transition!=="function"){throw"Transition function is not defined."}this.stop();this.sequence=fn.async.seq(_.bind(this.loadAndSet,this,image.src),fn.async.sync(_.bind(signals.Signal.prototype.dispatch,this.signals.imageLoaded)),_.bind(function(done,$newImage){this.transition($newImage,this.$currentImage,done)},this),_.bind(function(done,$newImage){this.signals.transitionFinished.dispatch($newImage);this.$currentImage=$newImage},this));this.sequence.start()};Slideshow.prototype.loadAndSet=function(src,done){this.$newImage=Slideshow.preprocessImage(dom.loadImage(src,done));return this.$newImage};Slideshow.prototype.stop=function(){this.sequence&&this.sequence.stop()};return{Slideshow:Slideshow}});